<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Relations and Functions Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .tab-btn.active {
            background: #3498db;
            color: white;
        }

        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .visual-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .set-diagram {
            flex: 1;
            min-width: 300px;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 15px;
            position: relative;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            overflow: hidden;
        }

        .interactive-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }

        .btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #95a5a6;
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.danger {
            background: #e74c3c;
        }

        .element {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .element:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .element.selected {
            border: 3px solid #fff;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.6);
            transform: scale(1.15);
        }

        .properties-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .property-indicator {
            display: inline-block;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .property-indicator.true {
            background: #27ae60;
            animation: pulse 1s ease-in-out;
        }

        .property-indicator.false {
            background: #e74c3c;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .matrix-display {
            display: grid;
            gap: 2px;
            margin: 20px auto;
            justify-content: center;
            max-width: 300px;
        }

        .matrix-cell {
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .matrix-cell:hover {
            background: #e9ecef;
        }

        .matrix-cell.active {
            background: #3498db;
            color: white;
            animation: cellActivate 0.3s ease;
        }

        @keyframes cellActivate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .examples-carousel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .definition-box {
            background: #e8f4f8;
            border-left: 5px solid #3498db;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
        }

        .quiz-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 300px;
        }

        .question {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .options {
            display: grid;
            gap: 10px;
            margin-bottom: 15px;
        }

        .option {
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #3498db;
            transform: translateX(5px);
        }

        .option.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        .option.correct {
            background: #27ae60;
            color: white;
            border-color: #229954;
        }

        .option.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .step-indicator {
            background: #ecf0f1;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }

        .step-indicator:hover {
            background: #d5dbdb;
            transform: translateX(5px);
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }

        .relation-connection {
            position: absolute;
            pointer-events: none;
            stroke: #e74c3c;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        @media (max-width: 768px) {
            .visual-container {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .element {
                width: 35px;
                height: 35px;
                font-size: 0.9em;
            }
        }

        .arrow-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid #e74c3c;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔗 Relations and Functions Interactive Tool</h1>
            <p>Master the concepts of Relations with hands-on visualization and practice!</p>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress"></div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('intro')">📚 Introduction</button>
            <button class="tab-btn" onclick="showTab('types')">🔍 Types of Relations</button>
            <button class="tab-btn" onclick="showTab('properties')">⚡ Properties Explorer</button>
            <button class="tab-btn" onclick="showTab('equivalence')">🟰 Equivalence Relations</button>
            <button class="tab-btn" onclick="showTab('examples')">💡 Interactive Examples</button>
            <button class="tab-btn" onclick="showTab('quiz')">🎯 Practice Quiz</button>
        </div>

        <!-- Introduction Section -->
        <div id="intro" class="content-section active">
            <h2>📚 Introduction to Relations</h2>
            
            <div class="definition-box">
                <h3>What is a Relation?</h3>
                <p>A <strong>relation</strong> from set A to set B is a subset of the Cartesian product A × B. If (a,b) ∈ R, we say "a is related to b" and write it as aRb.</p>
            </div>

            <div class="interactive-panel">
                <h3>🎮 Interactive Set Builder</h3>
                <p>Build your own sets and explore relations!</p>
                
                <div class="controls">
                    <input type="text" id="setAInput" placeholder="Enter elements for Set A (e.g., 1,2,3)" style="padding: 10px; border: 2px solid #ddd; border-radius: 5px; width: 200px;">
                    <input type="text" id="setBInput" placeholder="Enter elements for Set B (e.g., 4,5,6)" style="padding: 10px; border: 2px solid #ddd; border-radius: 5px; width: 200px;">
                    <button class="btn" onclick="createSets()">Create Sets</button>
                    <button class="btn secondary" onclick="generateRandomSets()">Random Sets</button>
                    <button class="btn success" onclick="clearRelations()">Clear Relations</button>
                </div>

                <div class="visual-container">
                    <div class="set-diagram" id="setA">
                        <h4 style="text-align: center; margin: 10px; color: #2c3e50;">Set A</h4>
                        <div id="setAElements"></div>
                    </div>
                    <div class="set-diagram" id="setB">
                        <h4 style="text-align: center; margin: 10px; color: #2c3e50;">Set B</h4>
                        <div id="setBElements"></div>
                        <div id="connectionLines"></div>
                    </div>
                </div>
                
                <div id="relationInfo" style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                    <p>Create sets to start exploring relations!</p>
                </div>
            </div>

            <div class="highlight-box">
                <h3>🎯 Learning Path</h3>
                <p>Journey through: Empty & Universal Relations → Properties (Reflexive, Symmetric, Transitive) → Equivalence Relations → Real-world Examples!</p>
            </div>
        </div>

        <!-- Types of Relations Section -->
        <div id="types" class="content-section">
            <h2>🔍 Types of Relations</h2>
            
            <div class="interactive-panel">
                <h3>Explore Different Relation Types</h3>
                <div class="controls">
                    <button class="btn" onclick="showRelationType('empty')">∅ Empty Relation</button>
                    <button class="btn" onclick="showRelationType('universal')">🌐 Universal Relation</button>
                    <button class="btn" onclick="showRelationType('identity')">🎯 Identity Relation</button>
                    <button class="btn secondary" onclick="toggleMatrix()">📊 Toggle Matrix</button>
                </div>

                <div class="visual-container">
                    <div class="set-diagram" id="relationVisualization">
                        <div style="text-align: center; padding: 50px; color: #7f8c8d;">
                            Select a relation type to visualize
                        </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <div id="matrixDisplay" class="matrix-display" style="display: none;">
                            <!-- Matrix will be generated here -->
                        </div>
                        
                        <div id="relationDetails" class="definition-box">
                            <h4>Relation Details</h4>
                            <p>Choose a relation type to see its definition and properties.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="examples-carousel">
                <h3>📝 Mathematical Examples from Textbook</h3>
                <div id="exampleContent">
                    <div class="step-indicator">
                        <strong>Example 1:</strong> In a boys school, the relation "a is sister of b" is an <strong>empty relation (∅)</strong> since no student can be sister of another.
                    </div>
                    <div class="step-indicator">
                        <strong>Example 2:</strong> The relation "difference in heights < 3 meters" is <strong>universal</strong> since this is always true for students.
                    </div>
                    <div class="step-indicator">
                        <strong>Example 3:</strong> Let A = {1, 2, 3, 4}. The relation R = {(a,b) : a - b = 10} is <strong>empty</strong> since no pairs satisfy this condition.
                    </div>
                </div>
            </div>
        </div>

        <!-- Properties Explorer Section -->
        <div id="properties" class="content-section">
            <h2>⚡ Properties Explorer</h2>
            
            <div class="interactive-panel">
                <h3>🔬 Test Relation Properties</h3>
                <p>Click elements to create pairs and see how properties change!</p>
                
                <div class="controls">
                    <button class="btn" onclick="resetRelation()">🔄 Reset</button>
                    <button class="btn success" onclick="addRandomPairs()">🎲 Add Random Pairs</button>
                    <button class="btn secondary" onclick="showMatrix()">📊 Show Matrix</button>
                    <button class="btn" onclick="makeReflexive()">↩️ Make Reflexive</button>
                    <button class="btn" onclick="makeSymmetric()">↔️ Make Symmetric</button>
                </div>

                <div class="visual-container">
                    <div class="set-diagram" id="propertiesVisualization">
                        <div id="propertySetElements"></div>
                        <div id="propertyConnections"></div>
                    </div>
                    
                    <div style="flex: 1;">
                        <div class="properties-panel">
                            <h3>🎯 Property Analysis</h3>
                            <div id="propertyResults">
                                <div class="property-indicator false">Reflexive: ?</div>
                                <div class="property-indicator false">Symmetric: ?</div>
                                <div class="property-indicator false">Transitive: ?</div>
                                <div class="property-indicator false">Equivalence: ?</div>
                            </div>
                            
                            <div id="propertyExplanation" style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                                <strong>How to use:</strong> Click elements to create relations. The properties will update automatically!
                            </div>
                        </div>
                        
                        <div id="propertyMatrix" class="matrix-display" style="display: none;">
                            <!-- Property matrix will be shown here -->
                        </div>
                    </div>
                </div>

                <div id="pairsList" style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px;">
                    <strong>Current Relation Pairs:</strong> <span id="currentPairs">{}</span>
                </div>
            </div>

            <div class="definition-box">
                <h3>📖 Property Definitions</h3>
                <ul>
                    <li><strong>Reflexive:</strong> (a,a) ∈ R for every a ∈ A</li>
                    <li><strong>Symmetric:</strong> If (a,b) ∈ R, then (b,a) ∈ R</li>
                    <li><strong>Transitive:</strong> If (a,b) ∈ R and (b,c) ∈ R, then (a,c) ∈ R</li>
                    <li><strong>Equivalence:</strong> Reflexive + Symmetric + Transitive</li>
                </ul>
            </div>
        </div>

        <!-- Equivalence Relations Section -->
        <div id="equivalence" class="content-section">
            <h2>🟰 Equivalence Relations</h2>
            
            <div class="definition-box">
                <h3>Equivalence Relations</h3>
                <p>A relation is an <strong>equivalence relation</strong> if it is reflexive, symmetric, and transitive. Equivalence relations partition sets into equivalence classes.</p>
            </div>

            <div class="interactive-panel">
                <h3>🎨 Equivalence Class Visualizer</h3>
                <div class="controls">
                    <button class="btn" onclick="showEquivalenceExample('modulo')">Modulo 3 (Integers)</button>
                    <button class="btn" onclick="showEquivalenceExample('parity')">Even/Odd Parity</button>
                    <button class="btn" onclick="showEquivalenceExample('triangles')">Triangle Congruence</button>
                    <button class="btn" onclick="showEquivalenceExample('lines')">Parallel Lines</button>
                </div>

                <div class="visual-container">
                    <div class="set-diagram" id="equivalenceVisualization">
                        <div style="text-align: center; padding: 50px; color: #7f8c8d;">
                            Choose an equivalence relation example
                        </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <div id="equivalenceDetails" class="properties-panel">
                            <h3>📊 Equivalence Classes</h3>
                            <div id="classDetails">
                                Select an example to see equivalence classes
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="examples-carousel">
                <h3>🧮 Mathematical Examples from Textbook</h3>
                <div class="step-indicator">
                    <strong>Example 5:</strong> R = {(a,b) : 2 divides (a-b)} in ℤ is an equivalence relation.
                    <br><em>Classes: [0] = all even integers, [1] = all odd integers</em>
                </div>
                <div class="step-indicator">
                    <strong>Example 6:</strong> R = {(a,b) : both a and b are either odd or even} in {1,2,3,4,5,6,7}
                    <br><em>Classes: {1,3,5,7} and {2,4,6}</em>
                </div>
            </div>
        </div>

        <!-- Interactive Examples Section -->
        <div id="examples" class="content-section">
            <h2>💡 Interactive Examples</h2>
            
            <div class="interactive-panel">
                <h3>🎪 Example Playground</h3>
                <div class="controls">
                    <button class="btn" onclick="loadExample('triangles')">📐 Triangle Congruence</button>
                    <button class="btn" onclick="loadExample('lines')">📏 Perpendicular Lines</button>
                    <button class="btn" onclick="loadExample('integers')">🔢 Integer Relations</button>
                    <button class="btn" onclick="loadExample('students')">👥 Student Relations</button>
                </div>

                <div id="exampleWorkspace" class="visual-container">
                    <div class="set-diagram" id="exampleVisualization">
                        <div style="text-align: center; padding: 50px; color: #7f8c8d;">
                            Select an example to explore
                        </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <div id="exampleSteps" class="definition-box">
                            <h4>Step-by-step Analysis</h4>
                            <p>Choose an example to see detailed analysis of its properties.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quiz" class="content-section">
            <h2>🎯 Practice Quiz</h2>
            
            <div class="quiz-container" id="quizContainer">
                <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                    <div style="font-size: 3em; margin-bottom: 20px;">🎯</div>
                    <div style="font-size: 1.2em;">Test your understanding!</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="startQuiz()">🚀 Start Quiz</button>
                <button class="btn" onclick="previousQuestion()" id="prevBtn" style="display: none;">⬅️ Previous</button>
                <button class="btn" onclick="nextQuestion()" id="nextBtn" style="display: none;">Next ➡️</button>
                <button class="btn success" onclick="submitQuiz()" id="submitBtn" style="display: none;">✅ Submit Quiz</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="quizProgress"></div>
            </div>
            
            <div id="quizResults" style="display: none;" class="highlight-box">
                <!-- Results will be shown here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'intro';
        let currentSetA = ['a', 'b', 'c'];
        let currentSetB = ['x', 'y', 'z'];
        let currentRelation = new Set();
        let relationConnections = [];
        let firstSelected = null;
        let currentQuizQuestion = 0;
        let quizAnswers = [];
        let quizStarted = false;
        let matrixVisible = false;

        // Quiz questions
        const quizQuestions = [
            {
                question: "Which of the following is an empty relation?",
                options: [
                    "R = {(a,b) : a ≤ b} in ℕ",
                    "R = {(a,b) : a is sister of b} in a boys school",
                    "R = {(a,b) : |a-b| ≥ 0} in ℝ", 
                    "R = {(a,b) : a = b} in any set"
                ],
                correct: 1,
                explanation: "In a boys school, no student can be sister of another student, making this relation empty."
            },
            {
                question: "A relation R is reflexive if:",
                options: [
                    "(a,a) ∈ R for some a ∈ A",
                    "(a,a) ∈ R for all a ∈ A",
                    "(a,b) ∈ R implies (b,a) ∈ R",
                    "R = A × A"
                ],
                correct: 1,
                explanation: "Reflexive means every element is related to itself: (a,a) ∈ R for all a ∈ A."
            },
            {
                question: "Which property does R = {(1,1), (2,2), (3,3), (1,2), (2,3)} in {1,2,3} satisfy?",
                options: [
                    "Reflexive only",
                    "Symmetric only", 
                    "Transitive only",
                    "None of the above"
                ],
                correct: 0,
                explanation: "R is reflexive since (1,1), (2,2), (3,3) ∈ R, but not symmetric since (1,2) ∈ R but (2,1) ∉ R."
            },
            {
                question: "An equivalence relation must be:",
                options: [
                    "Reflexive and symmetric only",
                    "Symmetric and transitive only",
                    "Reflexive, symmetric, and transitive",
                    "Either reflexive or transitive"
                ],
                correct: 2,
                explanation: "An equivalence relation must satisfy all three properties: reflexive, symmetric, and transitive."
            },
            {
                question: "The relation R = {(a,b) : 3 divides (a-b)} in ℤ creates how many equivalence classes?",
                options: [
                    "2 classes",
                    "3 classes", 
                    "Infinite classes",
                    "No classes"
                ],
                correct: 1,
                explanation: "The relation partitions ℤ into 3 classes: [0], [1], [2] based on remainders when divided by 3."
            }
        ];

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            currentTab = tabName;
            updateProgress();
            
            // Initialize tab-specific content
            if (tabName === 'properties') {
                setTimeout(() => initializePropertyExplorer(), 100);
            }
        }

        // Set creation functions
        function createSets() {
            const setAInput = document.getElementById('setAInput').value;
            const setBInput = document.getElementById('setBInput').value;
            
            currentSetA = setAInput.split(',').map(x => x.trim()).filter(x => x !== '');
            currentSetB = setBInput.split(',').map(x => x.trim()).filter(x => x !== '');
            
            if (currentSetA.length === 0) currentSetA = ['a', 'b', 'c'];
            if (currentSetB.length === 0) currentSetB = ['x', 'y', 'z'];
            
            relationConnections = [];
            displaySets();
            updateRelationInfo();
        }

        function generateRandomSets() {
            const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            const letters = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
            
            currentSetA = numbers.slice(0, 3 + Math.floor(Math.random() * 2));
            currentSetB = letters.slice(0, 3 + Math.floor(Math.random() * 2));
            
            document.getElementById('setAInput').value = currentSetA.join(',');
            document.getElementById('setBInput').value = currentSetB.join(',');
            
            relationConnections = [];
            displaySets();
            updateRelationInfo();
        }

        function clearRelations() {
            relationConnections = [];
            updateConnectionDisplay();
            updateRelationInfo();
        }

        function displaySets() {
            displaySet('setAElements', currentSetA, '#e74c3c');
            displaySet('setBElements', currentSetB, '#3498db');
            updateConnectionDisplay();
        }

        function displaySet(containerId, elements, color) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            elements.forEach((element, index) => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element';
                elementDiv.textContent = element;
                elementDiv.style.background = color;
                elementDiv.style.left = (50 + (index % 3) * 80) + 'px';
                elementDiv.style.top = (80 + Math.floor(index / 3) * 80) + 'px';
                elementDiv.onclick = () => selectElement(element, containerId);
                elementDiv.dataset.element = element;
                elementDiv.dataset.set = containerId;
                container.appendChild(elementDiv);
            });
        }

        function selectElement(element, containerId) {
            if (!firstSelected) {
                firstSelected = {element, set: containerId};
                document.querySelectorAll('.element').forEach(el => el.classList.remove('selected'));
                document.querySelector(`[data-element="${element}"][data-set="${containerId}"]`).classList.add('selected');
            } else {
                if (firstSelected.set !== containerId) {
                    const pair = `${firstSelected.element},${element}`;
                    const existingIndex = relationConnections.findIndex(conn => conn === pair);
                    
                    if (existingIndex >= 0) {
                        relationConnections.splice(existingIndex, 1);
                    } else {
                        relationConnections.push(pair);
                    }
                    
                    updateConnectionDisplay();
                    updateRelationInfo();
                }
                
                firstSelected = null;
                document.querySelectorAll('.element').forEach(el => el.classList.remove('selected'));
            }
        }

        function updateConnectionDisplay() {
            const container = document.getElementById('connectionLines');
            container.innerHTML = '';
            
            relationConnections.forEach(connection => {
                const [from, to] = connection.split(',');
                drawConnection(from, to, container);
            });
        }

        function drawConnection(from, to, container) {
            const fromElement = document.querySelector(`[data-element="${from}"]`);
            const toElement = document.querySelector(`[data-element="${to}"]`);
            
            if (fromElement && toElement) {
                const fromRect = fromElement.getBoundingClientRect();
                const toRect = toElement.getBoundingClientRect();
                const containerRect = container.parentElement.getBoundingClientRect();
                
                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.height = '2px';
                line.style.background = '#e74c3c';
                line.style.transformOrigin = '0 50%';
                line.style.pointerEvents = 'none';
                line.style.zIndex = '5';
                
                const fromX = fromRect.left - containerRect.left + fromRect.width / 2;
                const fromY = fromRect.top - containerRect.top + fromRect.height / 2;
                const toX = toRect.left - containerRect.left + toRect.width / 2;
                const toY = toRect.top - containerRect.top + toRect.height / 2;
                
                const length = Math.sqrt((toX - fromX) ** 2 + (toY - fromY) ** 2);
                const angle = Math.atan2(toY - fromY, toX - fromX);
                
                line.style.left = fromX + 'px';
                line.style.top = fromY + 'px';
                line.style.width = length + 'px';
                line.style.transform = `rotate(${angle}rad)`;
                
                // Add arrow
                const arrow = document.createElement('div');
                arrow.className = 'arrow-marker';
                arrow.style.left = (toX - 8) + 'px';
                arrow.style.top = (toY - 4) + 'px';
                arrow.style.transform = `rotate(${angle}rad)`;
                
                container.appendChild(line);
                container.appendChild(arrow);
            }
        }

        function updateRelationInfo() {
            const info = document.getElementById('relationInfo');
            const pairCount = relationConnections.length;
            const totalPossible = currentSetA.length * currentSetB.length;
            
            info.innerHTML = `
                <h4>Current Sets and Relation:</h4>
                <p><strong>Set A:</strong> {${currentSetA.join(', ')}}</p>
                <p><strong>Set B:</strong> {${currentSetB.join(', ')}}</p>
                <p><strong>Relation Pairs:</strong> {${relationConnections.map(p => `(${p.replace(',', ',')})`).join(', ') || 'none'}}</p>
                <p><strong>Size:</strong> ${pairCount} out of ${totalPossible} possible pairs</p>
                <p><em>Click elements from Set A then Set B to create/remove relation pairs!</em></p>
            `;
        }

        // Relation type visualization
        function showRelationType(type) {
            const container = document.getElementById('relationVisualization');
            const details = document.getElementById('relationDetails');
            
            let content = '';
            let detailContent = '';
            
            switch(type) {
                case 'empty':
                    content = `
                        <div style="text-align: center; padding: 40px;">
                            <h3 style="color: #e74c3c;">∅ Empty Relation</h3>
                            <div style="font-size: 3em; margin: 20px; color: #bdc3c7;">∅</div>
                            <p>R = ∅ ⊂ A × A</p>
                            <p style="margin-top: 20px; font-style: italic;">No connections between any elements</p>
                        </div>
                    `;
                    detailContent = `
                        <h4>Empty Relation (∅)</h4>
                        <p><strong>Definition:</strong> No element of A is related to any element of A</p>
                        <p><strong>Example:</strong> "a is sister of b" in a boys school</p>
                        <p><strong>Properties:</strong> Not reflexive, symmetric (vacuously), transitive (vacuously)</p>
                        <p><strong>Notation:</strong> R = ∅</p>
                    `;
                    createRelationMatrix([]);
                    break;
                    
                case 'universal':
                    content = `
                        <div style="text-align: center; padding: 40px;">
                            <h3 style="color: #27ae60;">🌐 Universal Relation</h3>
                            <div style="font-size: 2em; margin: 20px; color: #27ae60;">⚮⚮⚮</div>
                            <p>R = A × A</p>
                            <p style="margin-top: 20px; font-style: italic;">Every element connects to every element</p>
                        </div>
                    `;
                    detailContent = `
                        <h4>Universal Relation</h4>
                        <p><strong>Definition:</strong> Every element of A is related to every element of A</p>
                        <p><strong>Example:</strong> "difference in heights < 3 meters" for students</p>
                        <p><strong>Properties:</strong> Reflexive, symmetric, transitive (equivalence relation)</p>
                        <p><strong>Notation:</strong> R = A × A</p>
                    `;
                    createRelationMatrix('universal');
                    break;
                    
                case 'identity':
                    content = `
                        <div style="text-align: center; padding: 40px;">
                            <h3 style="color: #9b59b6;">🎯 Identity Relation</h3>
                            <div style="font-size: 2em; margin: 20px; color: #9b59b6;">⟲</div>
                            <p>R = {(a,a) : a ∈ A}</p>
                            <p style="margin-top: 20px; font-style: italic;">Each element relates only to itself</p>
                        </div>
                    `;
                    detailContent = `
                        <h4>Identity Relation</h4>
                        <p><strong>Definition:</strong> Each element is related only to itself</p>
                        <p><strong>Example:</strong> "a equals a" or "a has same height as a"</p>
                        <p><strong>Properties:</strong> Reflexive, symmetric, transitive (equivalence relation)</p>
                        <p><strong>Notation:</strong> I_A = {(a,a) : a ∈ A}</p>
                    `;
                    createRelationMatrix('identity');
                    break;
            }
            
            container.innerHTML = content;
            details.innerHTML = detailContent;
        }

        function createRelationMatrix(type) {
            const matrixDisplay = document.getElementById('matrixDisplay');
            const elements = ['a', 'b', 'c'];
            
            matrixDisplay.innerHTML = '';
            matrixDisplay.style.gridTemplateColumns = `repeat(${elements.length + 1}, 40px)`;
            
            // Header row
            const emptyCell = document.createElement('div');
            emptyCell.className = 'matrix-cell';
            emptyCell.style.background = '#f8f9fa';
            matrixDisplay.appendChild(emptyCell);
            
            elements.forEach(element => {
                const headerCell = document.createElement('div');
                headerCell.className = 'matrix-cell';
                headerCell.textContent = element;
                headerCell.style.background = '#3498db';
                headerCell.style.color = 'white';
                matrixDisplay.appendChild(headerCell);
            });
            
            // Data rows
            elements.forEach((rowElement, i) => {
                const rowHeader = document.createElement('div');
                rowHeader.className = 'matrix-cell';
                rowHeader.textContent = rowElement;
                rowHeader.style.background = '#3498db';
                rowHeader.style.color = 'white';
                matrixDisplay.appendChild(rowHeader);
                
                elements.forEach((colElement, j) => {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    
                    let value = '0';
                    if (type === 'universal') {
                        value = '1';
                        cell.classList.add('active');
                    } else if (type === 'identity' && i === j) {
                        value = '1';
                        cell.classList.add('active');
                    }
                    
                    cell.textContent = value;
                    matrixDisplay.appendChild(cell);
                });
            });
        }

        function toggleMatrix() {
            const matrixDisplay = document.getElementById('matrixDisplay');
            matrixVisible = !matrixVisible;
            matrixDisplay.style.display = matrixVisible ? 'grid' : 'none';
        }

        // Properties exploration
        function resetRelation() {
            currentRelation.clear();
            initializePropertyExplorer();
            updatePropertyDisplay();
        }

        function initializePropertyExplorer() {
            const container = document.getElementById('propertySetElements');
            const elements = ['1', '2', '3', '4'];
            
            container.innerHTML = '';
            
            elements.forEach((element, index) => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element';
                elementDiv.textContent = element;
                elementDiv.style.background = '#3498db';
                elementDiv.style.left = (50 + (index % 2) * 150) + 'px';
                elementDiv.style.top = (50 + Math.floor(index / 2) * 150) + 'px';
                elementDiv.onclick = () => selectPropertyElement(element);
                elementDiv.dataset.element = element;
                container.appendChild(elementDiv);
            });
            
            updatePropertyConnections();
        }

        function selectPropertyElement(element) {
            if (!firstSelected) {
                firstSelected = element;
                document.querySelectorAll('#propertySetElements .element').forEach(el => {
                    el.classList.remove('selected');
                    if (el.textContent === element) el.classList.add('selected');
                });
            } else {
                const pair = `${firstSelected},${element}`;
                if (currentRelation.has(pair)) {
                    currentRelation.delete(pair);
                } else {
                    currentRelation.add(pair);
                }
                firstSelected = null;
                document.querySelectorAll('#propertySetElements .element').forEach(el => {
                    el.classList.remove('selected');
                });
                updatePropertyDisplay();
                updatePropertyConnections();
            }
        }

        function addRandomPairs() {
            const elements = ['1', '2', '3', '4'];
            for (let i = 0; i < 3; i++) {
                const a = elements[Math.floor(Math.random() * elements.length)];
                const b = elements[Math.floor(Math.random() * elements.length)];
                currentRelation.add(`${a},${b}`);
            }
            updatePropertyDisplay();
            updatePropertyConnections();
        }

        function makeReflexive() {
            const elements = ['1', '2', '3', '4'];
            elements.forEach(e => currentRelation.add(`${e},${e}`));
            updatePropertyDisplay();
            updatePropertyConnections();
        }

        function makeSymmetric() {
            const pairs = Array.from(currentRelation);
            pairs.forEach(pair => {
                const [a, b] = pair.split(',');
                currentRelation.add(`${b},${a}`);
            });
            updatePropertyDisplay();
            updatePropertyConnections();
        }

        function updatePropertyConnections() {
            const container = document.getElementById('propertyConnections');
            container.innerHTML = '';
            
            currentRelation.forEach(pair => {
                const [from, to] = pair.split(',');
                drawPropertyConnection(from, to, container);
            });
        }

        function drawPropertyConnection(from, to, container) {
            const fromElement = document.querySelector(`#propertySetElements [data-element="${from}"]`);
            const toElement = document.querySelector(`#propertySetElements [data-element="${to}"]`);
            
            if (fromElement && toElement) {
                const fromRect = fromElement.getBoundingClientRect();
                const toRect = toElement.getBoundingClientRect();
                const containerRect = container.parentElement.getBoundingClientRect();
                
                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.height = '3px';
                line.style.background = from === to ? '#27ae60' : '#e74c3c';
                line.style.transformOrigin = '0 50%';
                line.style.pointerEvents = 'none';
                line.style.zIndex = '5';
                line.style.borderRadius = '2px';
                
                const fromX = fromRect.left - containerRect.left + fromRect.width / 2;
                const fromY = fromRect.top - containerRect.top + fromRect.height / 2;
                const toX = toRect.left - containerRect.left + toRect.width / 2;
                const toY = toRect.top - containerRect.top + toRect.height / 2;
                
                if (from === to) {
                    // Self-loop
                    const loop = document.createElement('div');
                    loop.style.position = 'absolute';
                    loop.style.width = '20px';
                    loop.style.height = '20px';
                    loop.style.border = '3px solid #27ae60';
                    loop.style.borderRadius = '50%';
                    loop.style.left = (fromX - 10) + 'px';
                    loop.style.top = (fromY - 30) + 'px';
                    loop.style.pointerEvents = 'none';
                    container.appendChild(loop);
                } else {
                    const length = Math.sqrt((toX - fromX) ** 2 + (toY - fromY) ** 2);
                    const angle = Math.atan2(toY - fromY, toX - fromX);
                    
                    line.style.left = fromX + 'px';
                    line.style.top = fromY + 'px';
                    line.style.width = length + 'px';
                    line.style.transform = `rotate(${angle}rad)`;
                    
                    // Add arrow
                    const arrow = document.createElement('div');
                    arrow.className = 'arrow-marker';
                    arrow.style.left = (toX - 8) + 'px';
                    arrow.style.top = (toY - 4) + 'px';
                    arrow.style.transform = `rotate(${angle}rad)`;
                    
                    container.appendChild(line);
                    container.appendChild(arrow);
                }
            }
        }

        function updatePropertyDisplay() {
            const pairs = Array.from(currentRelation);
            document.getElementById('currentPairs').textContent = `{${pairs.map(p => `(${p.replace(',', ',')})`).join(', ')}}`;
            
            const isReflexive = checkReflexive();
            const isSymmetric = checkSymmetric();
            const isTransitive = checkTransitive();
            const isEquivalence = isReflexive && isSymmetric && isTransitive;
            
            const results = document.getElementById('propertyResults');
            results.innerHTML = `
                <div class="property-indicator ${isReflexive ? 'true' : 'false'}">Reflexive: ${isReflexive ? '✓' : '✗'}</div>
                <div class="property-indicator ${isSymmetric ? 'true' : 'false'}">Symmetric: ${isSymmetric ? '✓' : '✗'}</div>
                <div class="property-indicator ${isTransitive ? 'true' : 'false'}">Transitive: ${isTransitive ? '✓' : '✗'}</div>
                <div class="property-indicator ${isEquivalence ? 'true' : 'false'}">Equivalence: ${isEquivalence ? '✓' : '✗'}</div>
            `;
            
            updatePropertyExplanation(isReflexive, isSymmetric, isTransitive);
        }

        function checkReflexive() {
            const elements = ['1', '2', '3', '4'];
            return elements.every(e => currentRelation.has(`${e},${e}`));
        }

        function checkSymmetric() {
            return Array.from(currentRelation).every(pair => {
                const [a, b] = pair.split(',');
                return currentRelation.has(`${b},${a}`);
            });
        }

        function checkTransitive() {
            const pairs = Array.from(currentRelation);
            for (let pair1 of pairs) {
                const [a, b] = pair1.split(',');
                for (let pair2 of pairs) {
                    const [c, d] = pair2.split(',');
                    if (b === c && !currentRelation.has(`${a},${d}`)) {
                        return false;
                    }
                }
            }
            return true;
        }

        function updatePropertyExplanation(reflexive, symmetric, transitive) {
            const explanation = document.getElementById('propertyExplanation');
            let text = '';
            
            if (!reflexive) text += '❌ Missing self-relations (a,a). ';
            if (!symmetric) text += '❌ Some pairs lack reverse pairs (a,b) ↔ (b,a). ';
            if (!transitive) text += '❌ Missing transitive connections. ';
            
            if (reflexive && symmetric && transitive) {
                text = '🎉 This is an equivalence relation! It partitions the set into equivalence classes.';
            } else if (text === '') {
                text = '✨ Add more pairs or use the helper buttons to explore properties!';
            }
            
            explanation.innerHTML = text;
        }

        function showMatrix() {
            const matrixContainer = document.getElementById('propertyMatrix');
            const isVisible = matrixContainer.style.display !== 'none';
            
            if (isVisible) {
                matrixContainer.style.display = 'none';
                return;
            }
            
            const elements = ['1', '2', '3', '4'];
            matrixContainer.innerHTML = '';
            matrixContainer.style.display = 'grid';
            matrixContainer.style.gridTemplateColumns = `repeat(${elements.length + 1}, 40px)`;
            
            // Header row
            const emptyCell = document.createElement('div');
            emptyCell.className = 'matrix-cell';
            emptyCell.style.background = '#f8f9fa';
            matrixContainer.appendChild(emptyCell);
            
            elements.forEach(element => {
                const headerCell = document.createElement('div');
                headerCell.className = 'matrix-cell';
                headerCell.textContent = element;
                headerCell.style.background = '#3498db';
                headerCell.style.color = 'white';
                matrixContainer.appendChild(headerCell);
            });
            
            // Data rows
            elements.forEach(rowElement => {
                const rowHeader = document.createElement('div');
                rowHeader.className = 'matrix-cell';
                rowHeader.textContent = rowElement;
                rowHeader.style.background = '#3498db';
                rowHeader.style.color = 'white';
                matrixContainer.appendChild(rowHeader);
                
                elements.forEach(colElement => {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    
                    const hasRelation = currentRelation.has(`${rowElement},${colElement}`);
                    cell.textContent = hasRelation ? '1' : '0';
                    
                    if (hasRelation) {
                        cell.classList.add('active');
                    }
                    
                    cell.onclick = () => {
                        const pair = `${rowElement},${colElement}`;
                        if (currentRelation.has(pair)) {
                            currentRelation.delete(pair);
                        } else {
                            currentRelation.add(pair);
                        }
                        updatePropertyDisplay();
                        updatePropertyConnections();
                        showMatrix(); // Refresh matrix
                    };
                    
                    matrixContainer.appendChild(cell);
                });
            });
        }

        // Equivalence relation examples
        function showEquivalenceExample(type) {
            const container = document.getElementById('equivalenceVisualization');
            const details = document.getElementById('classDetails');
            
            switch(type) {
                case 'modulo':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>Modulo 3 Relation in ℤ</h3>
                            <p style="margin-bottom: 20px;">R = {(a,b) : 3 divides (a-b)}</p>
                            <div style="display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; gap: 15px;">
                                <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 10px; min-width: 120px;">
                                    <strong>[0]</strong><br>..., -6, -3, 0, 3, 6, ...
                                </div>
                                <div style="background: #27ae60; color: white; padding: 15px; border-radius: 10px; min-width: 120px;">
                                    <strong>[1]</strong><br>..., -5, -2, 1, 4, 7, ...
                                </div>
                                <div style="background: #3498db; color: white; padding: 15px; border-radius: 10px; min-width: 120px;">
                                    <strong>[2]</strong><br>..., -4, -1, 2, 5, 8, ...
                                </div>
                            </div>
                        </div>
                    `;
                    details.innerHTML = `
                        <h4>Modulo 3 Equivalence Classes</h4>
                        <p><strong>Relation:</strong> R = {(a,b) : 3 divides (a-b)}</p>
                        <p><strong>Classes:</strong> 3 equivalence classes based on remainder when divided by 3</p>
                        <p><strong>Example:</strong> 7 ≡ 1 (mod 3), so 7 ∈ [1]</p>
                        <p><strong>Properties:</strong> ✓ Reflexive ✓ Symmetric ✓ Transitive</p>
                    `;
                    break;
                    
                case 'parity':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>Even/Odd Parity in {1,2,3,4,5,6,7}</h3>
                            <p style="margin-bottom: 20px;">R = {(a,b) : both a and b are either odd or even}</p>
                            <div style="display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; gap: 20px;">
                                <div style="background: #9b59b6; color: white; padding: 20px; border-radius: 10px; min-width: 150px;">
                                    <strong>Odd Numbers</strong><br>{1, 3, 5, 7}
                                </div>
                                <div style="background: #e67e22; color: white; padding: 20px; border-radius: 10px; min-width: 150px;">
                                    <strong>Even Numbers</strong><br>{2, 4, 6}
                                </div>
                            </div>
                        </div>
                    `;
                    details.innerHTML = `
                        <h4>Parity Equivalence Classes</h4>
                        <p><strong>Relation:</strong> Both a and b are either odd or even</p>
                        <p><strong>Classes:</strong> 2 equivalence classes</p>
                        <p><strong>Property:</strong> No odd number relates to any even number</p>
                        <p><strong>Example:</strong> (1,3), (1,5), (2,4), (2,6) ∈ R but (1,2) ∉ R</p>
                    `;
                    break;
                    
                case 'triangles':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>Triangle Congruence Relation</h3>
                            <p style="margin-bottom: 20px;">R = {(T₁,T₂) : T₁ is congruent to T₂}</p>
                            <div style="display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; gap: 15px;">
                                <div style="background: #1abc9c; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Class 1</strong><br>All triangles with<br>sides 3,4,5
                                </div>
                                <div style="background: #f39c12; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Class 2</strong><br>All triangles with<br>sides 5,12,13
                                </div>
                                <div style="background: #8e44ad; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Class 3</strong><br>All equilateral<br>triangles
                                </div>
                            </div>
                        </div>
                    `;
                    details.innerHTML = `
                        <h4>Triangle Congruence Classes</h4>
                        <p><strong>Relation:</strong> Triangle congruence (SSS, SAS, ASA, etc.)</p>
                        <p><strong>Classes:</strong> Each class contains all congruent triangles</p>
                        <p><strong>Properties:</strong> ✓ Reflexive ✓ Symmetric ✓ Transitive</p>
                        <p><strong>Note:</strong> This is the example from your textbook (Example 2)</p>
                    `;
                    break;
                    
                case 'lines':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>Parallel Lines Relation</h3>
                            <p style="margin-bottom: 20px;">R = {(L₁,L₂) : L₁ is parallel to L₂}</p>
                            <div style="margin: 30px 0;">
                                <svg width="300" height="200" style="border: 1px solid #ddd; border-radius: 10px; background: white;">
                                    <line x1="20" y1="40" x2="280" y2="40" stroke="#e74c3c" stroke-width="3"/>
                                    <line x1="20" y1="80" x2="280" y2="80" stroke="#e74c3c" stroke-width="3"/>
                                    <line x1="20" y1="120" x2="280" y2="120" stroke="#e74c3c" stroke-width="3"/>
                                    <text x="150" y="170" text-anchor="middle" fill="#2c3e50">Parallel Lines Class</text>
                                </svg>
                            </div>
                        </div>
                    `;
                    details.innerHTML = `
                        <h4>Parallel Lines Classes</h4>
                        <p><strong>Relation:</strong> Line parallelism in a plane</p>
                        <p><strong>Classes:</strong> Each class contains all parallel lines</p>
                        <p><strong>Properties:</strong> ✓ Reflexive ✓ Symmetric ✓ Transitive</p>
                        <p><strong>Note:</strong> Unlike perpendicular lines (Example 3), this IS an equivalence relation</p>
                    `;
                    break;
            }
        }

        // Interactive examples
        function loadExample(type) {
            const container = document.getElementById('exampleVisualization');
            const steps = document.getElementById('exampleSteps');
            
            switch(type) {
                case 'triangles':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>📐 Triangle Congruence (Example 2)</h3>
                            <div style="margin: 20px 0;">
                                <p><strong>Relation:</strong> R = {(T₁, T₂) : T₁ is congruent to T₂}</p>
                            </div>
                            <div style="display: flex; justify-content: space-around; margin: 30px 0;">
                                <div style="text-align: center;">
                                    <div style="width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 50px solid #e74c3c; margin: 0 auto;"></div>
                                    <p>Triangle A</p>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 50px solid #27ae60; margin: 0 auto;"></div>
                                    <p>Triangle B</p>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 50px solid #3498db; margin: 0 auto;"></div>
                                    <p>Triangle C</p>
                                </div>
                            </div>
                        </div>
                    `;
                    steps.innerHTML = `
                        <h4>Step-by-step Analysis</h4>
                        <div class="step-indicator">
                            <strong>Step 1 - Reflexive:</strong> Every triangle is congruent to itself. ✓
                        </div>
                        <div class="step-indicator">
                            <strong>Step 2 - Symmetric:</strong> If T₁ ≅ T₂, then T₂ ≅ T₁. ✓
                        </div>
                        <div class="step-indicator">
                            <strong>Step 3 - Transitive:</strong> If T₁ ≅ T₂ and T₂ ≅ T₃, then T₁ ≅ T₃. ✓
                        </div>
                        <div class="step-indicator">
                            <strong>Conclusion:</strong> This is an equivalence relation! 🎉
                        </div>
                    `;
                    break;
                    
                case 'lines':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>📏 Perpendicular Lines (Example 3)</h3>
                            <div style="margin: 20px 0;">
                                <p><strong>Relation:</strong> R = {(L₁, L₂) : L₁ ⊥ L₂}</p>
                            </div>
                            <svg width="300" height="200" style="border: 1px solid #ddd; border-radius: 10px; background: white; margin: 20px 0;">
                                <line x1="150" y1="20" x2="150" y2="180" stroke="#e74c3c" stroke-width="3"/>
                                <line x1="50" y1="100" x2="250" y2="100" stroke="#3498db" stroke-width="3"/>
                                <line x1="80" y1="40" x2="220" y2="160" stroke="#27ae60" stroke-width="3"/>
                                <text x="160" y="35" fill="#e74c3c">L₁</text>
                                <text x="255" y="95" fill="#3498db">L₂</text>
                                <text x="225" y="165" fill="#27ae60">L₃</text>
                            </svg>
                        </div>
                    `;
                    steps.innerHTML = `
                        <h4>Step-by-step Analysis</h4>
                        <div class="step-indicator">
                            <strong>Step 1 - Reflexive:</strong> Can a line be perpendicular to itself? ✗ No!
                        </div>
                        <div class="step-indicator">
                            <strong>Step 2 - Symmetric:</strong> If L₁ ⊥ L₂, then L₂ ⊥ L₁. ✓ Yes!
                        </div>
                        <div class="step-indicator">
                            <strong>Step 3 - Transitive:</strong> If L₁ ⊥ L₂ and L₂ ⊥ L₃, then L₁ ⊥ L₃? ✗ No! (L₁ ∥ L₃)
                        </div>
                        <div class="step-indicator">
                            <strong>Conclusion:</strong> Only symmetric, not reflexive or transitive.
                        </div>
                    `;
                    break;
                    
                case 'integers':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>🔢 Integer Relation (Example 5)</h3>
                            <div style="margin: 20px 0;">
                                <p><strong>Relation:</strong> R = {(a,b) : 2 divides (a-b)}</p>
                            </div>
                            <div style="display: flex; justify-content: space-around; margin: 30px 0;">
                                <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Even [0]</strong><br>..., -4, -2, 0, 2, 4, ...
                                </div>
                                <div style="background: #3498db; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Odd [1]</strong><br>..., -3, -1, 1, 3, 5, ...
                                </div>
                            </div>
                        </div>
                    `;
                    steps.innerHTML = `
                        <h4>Step-by-step Analysis</h4>
                        <div class="step-indicator">
                            <strong>Step 1 - Reflexive:</strong> 2 divides (a-a) = 0 for all a. ✓
                        </div>
                        <div class="step-indicator">
                            <strong>Step 2 - Symmetric:</strong> If 2|(a-b), then 2|(b-a). ✓
                        </div>
                        <div class="step-indicator">
                            <strong>Step 3 - Transitive:</strong> If 2|(a-b) and 2|(b-c), then 2|(a-c). ✓
                        </div>
                        <div class="step-indicator">
                            <strong>Conclusion:</strong> This is an equivalence relation creating 2 classes!
                        </div>
                    `;
                    break;
                    
                case 'students':
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>👥 Student Relations</h3>
                            <div style="margin: 20px 0;">
                                <p><strong>Multiple relation examples from textbook</strong></p>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
                                <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Brother/Sister</strong><br>Empty in boys school
                                </div>
                                <div style="background: #27ae60; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Height Diff < 3m</strong><br>Universal relation
                                </div>
                                <div style="background: #3498db; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Same Age</strong><br>Equivalence relation
                                </div>
                                <div style="background: #9b59b6; color: white; padding: 15px; border-radius: 10px;">
                                    <strong>Lives in Same Area</strong><br>Equivalence relation
                                </div>
                            </div>
                        </div>
                    `;
                    steps.innerHTML = `
                        <h4>Real-world Relation Analysis</h4>
                        <div class="step-indicator">
                            <strong>Empty Relations:</strong> "Sister of" in boys school - impossible connections
                        </div>
                        <div class="step-indicator">
                            <strong>Universal Relations:</strong> "Height difference < 3m" - always true for students
                        </div>
                        <div class="step-indicator">
                            <strong>Equivalence Relations:</strong> Group students by age, locality, etc.
                        </div>
                        <div class="step-indicator">
                            <strong>Applications:</strong> Database grouping, classification systems
                        </div>
                    `;
                    break;
            }
        }

        // Quiz functions
        function startQuiz() {
            currentQuizQuestion = 0;
            quizAnswers = new Array(quizQuestions.length).fill(null);
            quizStarted = true;
            
            document.getElementById('prevBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'inline-block';
            document.getElementById('quizResults').style.display = 'none';
            
            showQuizQuestion();
            updateQuizProgress();
        }

        function showQuizQuestion() {
            const container = document.getElementById('quizContainer');
            const question = quizQuestions[currentQuizQuestion];
            
            container.innerHTML = `
                <div class="question">
                    Question ${currentQuizQuestion + 1} of ${quizQuestions.length}: ${question.question}
                </div>
                <div class="options">
                    ${question.options.map((option, index) => `
                        <div class="option" onclick="selectQuizAnswer(${index})" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>
                    `).join('')}
                </div>
                <div id="explanation" style="display: none; background: #e8f4f8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>💡 Explanation:</strong> ${question.explanation}
                </div>
            `;
            
            if (quizAnswers[currentQuizQuestion] !== null) {
                const selectedOption = container.querySelector(`[data-index="${quizAnswers[currentQuizQuestion]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                    document.getElementById('explanation').style.display = 'block';
                }
            }
            
            document.getElementById('prevBtn').disabled = currentQuizQuestion === 0;
            document.getElementById('nextBtn').style.display = currentQuizQuestion === quizQuestions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = currentQuizQuestion === quizQuestions.length - 1 ? 'inline-block' : 'none';
        }

        function selectQuizAnswer(answerIndex) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            
            const selectedOption = document.querySelector(`[data-index="${answerIndex}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                quizAnswers[currentQuizQuestion] = answerIndex;
                document.getElementById('explanation').style.display = 'block';
            }
        }

        function nextQuestion() {
            if (currentQuizQuestion < quizQuestions.length - 1) {
                currentQuizQuestion++;
                showQuizQuestion();
                updateQuizProgress();
            }
        }

        function previousQuestion() {
            if (currentQuizQuestion > 0) {
                currentQuizQuestion--;
                showQuizQuestion();
                updateQuizProgress();
            }
        }

        function submitQuiz() {
            let correctAnswers = 0;
            quizAnswers.forEach((answer, index) => {
                if (answer === quizQuestions[index].correct) {
                    correctAnswers++;
                }
            });
            
            const percentage = Math.round((correctAnswers / quizQuestions.length) * 100);
            const resultsContainer = document.getElementById('quizResults');
            
            let message = '';
            let color = '';
            
            if (percentage >= 80) {
                message = 'Excellent! You have mastered relations! 🎉';
                color = '#27ae60';
            } else if (percentage >= 60) {
                message = 'Good job! Review the concepts once more. 👍';
                color = '#f39c12';
            } else {
                message = 'Keep studying! Practice more examples. 💪';
                color = '#e74c3c';
            }
            
            resultsContainer.innerHTML = `
                <h3 style="color: ${color};">🎯 Quiz Results</h3>
                <div style="font-size: 1.5em; margin: 20px 0;">
                    Score: ${correctAnswers}/${quizQuestions.length} (${percentage}%)
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px;">
                    ${message}
                </div>
                <button class="btn" onclick="startQuiz()" style="margin-top: 15px;">🔄 Retake Quiz</button>
            `;
            
            resultsContainer.style.display = 'block';
            document.getElementById('quizContainer').style.display = 'none';
            document.querySelector('#quiz .controls').style.display = 'none';
        }

        function updateQuizProgress() {
            const progress = ((currentQuizQuestion + 1) / quizQuestions.length) * 100;
            document.getElementById('quizProgress').style.width = progress + '%';
        }

        function updateProgress() {
            const tabs = ['intro', 'types', 'properties', 'equivalence', 'examples', 'quiz'];
            const currentIndex = tabs.indexOf(currentTab);
            const progress = ((currentIndex + 1) / tabs.length) * 100;
            document.getElementById('overallProgress').style.width = progress + '%';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateRandomSets();
            updateProgress();
            
            // Initialize property explorer after a short delay
            setTimeout(() => {
                initializePropertyExplorer();
            }, 500);
        });
    </script>
</body>
</html>
