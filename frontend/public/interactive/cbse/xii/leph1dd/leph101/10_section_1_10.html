<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electric Dipole Interactive Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .simulation-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .side-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .canvas-container {
            border: 3px solid #e0e6ed;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
            background: #f0f8ff;
        }

        canvas {
            display: block;
            background: radial-gradient(circle at center, #f0f8ff, #e6f3ff);
        }

        .dipole-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 25px;
        }

        .dipole-info h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .dipole-components {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .component-box {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }

        .component-value {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
        }

        .control-group h4 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.2rem;
        }

        .slider-container {
            margin-bottom: 18px;
            position: relative;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, #667eea, #764ba2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 3px solid #667eea;
        }

        .value-display {
            position: absolute;
            right: 0;
            top: 0;
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .visual-demos {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .demo-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .info-tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f8fafc;
            border-radius: 15px;
            padding: 5px;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .formula-box {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.3rem;
        }

        .key-points {
            background: linear-gradient(135deg, #e8f5e8, #c6f6d5);
            border-left: 5px solid #48bb78;
            padding: 20px;
            border-radius: 0 15px 15px 0;
            margin: 20px 0;
        }

        .key-points h4 {
            color: #2f855a;
            margin-bottom: 15px;
        }

        .highlight {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #fdcb6e;
        }

        .quiz-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            margin-top: 25px;
            grid-column: span 2;
        }

        .quiz-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .question-card {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }

        .question-card.correct {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .question-card.incorrect {
            border-color: #f56565;
            background: #fff5f5;
        }

        .question-number {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option:hover {
            border-color: #667eea;
        }

        .option.selected {
            border-color: #667eea;
            background: #ebf8ff;
        }

        .option.correct {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .option.incorrect {
            border-color: #f56565;
            background: #fff5f5;
        }

        .option-letter {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .check-button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .check-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .explanation {
            background: #fff7ed;
            border: 2px solid #fb923c;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .score-display {
            text-align: center;
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .quiz-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .controls-grid, .visual-demos, .quiz-container {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Electric Dipole Interactive Explorer</h1>
            <p>Discover the fascinating world of electric dipoles through interactive visualizations</p>
        </div>

        <div class="main-layout">
            <div class="simulation-panel">
                <h3>üî¨ Interactive Dipole Field Simulation</h3>
                
                <div class="canvas-container">
                    <canvas id="dipoleCanvas" width="700" height="500"></canvas>
                </div>

                <div class="dipole-info">
                    <h3>Electric Dipole Properties</h3>
                    <div id="dipoleValue">p = 1.0 √ó 10‚Åª‚Å∂ C‚ãÖm</div>
                    <p>p = q √ó 2a (from -q to +q)</p>
                    
                    <div class="dipole-components">
                        <div class="component-box">
                            <h4>Charge (q)</h4>
                            <div class="component-value" id="chargeComponent">1.0 ¬µC</div>
                        </div>
                        <div class="component-box">
                            <h4>Separation (2a)</h4>
                            <div class="component-value" id="separationComponent">1.0 mm</div>
                        </div>
                        <div class="component-box">
                            <h4>Distance (r)</h4>
                            <div class="component-value" id="distanceComponent">5.0 cm</div>
                        </div>
                        <div class="component-box">
                            <h4>Field (E)</h4>
                            <div class="component-value" id="fieldComponent">0.0 N/C</div>
                        </div>
                    </div>
                </div>

                <div class="controls-grid">
                    <div class="control-group">
                        <h4>‚ö° Dipole Properties</h4>
                        <div class="slider-container">
                            <label>Charge Magnitude (q):</label>
                            <input type="range" id="chargeSlider" min="0.1" max="5" value="1" step="0.1">
                            <span class="value-display" id="chargeValue">1.0 ¬µC</span>
                        </div>
                        <div class="slider-container">
                            <label>Charge Separation (2a):</label>
                            <input type="range" id="separationSlider" min="0.5" max="3" value="1" step="0.1">
                            <span class="value-display" id="separationValue">1.0 mm</span>
                        </div>
                        <div class="slider-container">
                            <label>Dipole Orientation:</label>
                            <input type="range" id="orientationSlider" min="0" max="360" value="0" step="15">
                            <span class="value-display" id="orientationValue">0¬∞</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <h4>üìç Test Point</h4>
                        <div class="slider-container">
                            <label>Distance from Center (r):</label>
                            <input type="range" id="distanceSlider" min="2" max="10" value="5" step="0.5">
                            <span class="value-display" id="distanceValue">5.0 cm</span>
                        </div>
                        <div class="slider-container">
                            <label>Angle from Axis (Œ∏):</label>
                            <input type="range" id="angleSlider" min="0" max="180" value="0" step="15">
                            <span class="value-display" id="angleValue">0¬∞</span>
                        </div>
                        <div class="slider-container">
                            <label>Field Lines Density:</label>
                            <input type="range" id="densitySlider" min="5" max="20" value="12" step="1">
                            <span class="value-display" id="densityValue">12</span>
                        </div>
                    </div>
                </div>

                <div class="visual-demos">
                    <div class="demo-card" onclick="setDemo('axial')">
                        <h4>üéØ Axial Point</h4>
                        <p>E = 2p/(4œÄŒµ‚ÇÄr¬≥) along axis</p>
                    </div>
                    <div class="demo-card" onclick="setDemo('equatorial')">
                        <h4>‚ä• Equatorial Point</h4>
                        <p>E = p/(4œÄŒµ‚ÇÄr¬≥) opposite to p</p>
                    </div>
                    <div class="demo-card" onclick="setDemo('closeup')">
                        <h4>üîç Close-up View</h4>
                        <p>Individual charge effects visible</p>
                    </div>
                    <div class="demo-card" onclick="setDemo('faraway')">
                        <h4>üåå Far-field</h4>
                        <p>Pure dipole behavior (r >> a)</p>
                    </div>
                </div>
            </div>

            <div class="side-panel">
                <div class="info-tabs">
                    <button class="tab-button active" onclick="showTab(event, 'concept')">Concept</button>
                    <button class="tab-button" onclick="showTab(event, 'formulas')">Formulas</button>
                    <button class="tab-button" onclick="showTab(event, 'applications')">Applications</button>
                </div>

                <div id="concept" class="tab-content active">
                    <h3>üí° Electric Dipole Fundamentals</h3>
                    <p style="margin-bottom: 15px; line-height: 1.6;">
                        An electric dipole consists of two equal and opposite charges (+q and -q) 
                        separated by a small distance 2a. Despite having zero net charge, 
                        it creates a unique electric field pattern.
                    </p>

                    <div class="key-points">
                        <h4>üîë Key Properties:</h4>
                        <ul>
                            <li><strong>Dipole Moment:</strong> p = q √ó 2a (vector from -q to +q)</li>
                            <li><strong>Net Charge:</strong> Zero, but field doesn't cancel completely</li>
                            <li><strong>Field Decay:</strong> Falls as 1/r¬≥ (faster than single charge)</li>
                            <li><strong>Direction Dependence:</strong> Field depends on angle Œ∏</li>
                        </ul>
                    </div>

                    <div class="highlight">
                        <h4>üéÆ Simulation Features:</h4>
                        <p>‚Ä¢ <strong>Red/Blue spheres:</strong> +q and -q charges</p>
                        <p>‚Ä¢ <strong>Green arrow:</strong> Dipole moment vector p</p>
                        <p>‚Ä¢ <strong>Yellow point:</strong> Test point for field calculation</p>
                        <p>‚Ä¢ <strong>Field lines:</strong> Show dipole field pattern</p>
                        <p>‚Ä¢ <strong>Orange arrow:</strong> Electric field at test point</p>
                    </div>
                </div>

                <div id="formulas" class="tab-content">
                    <h3>üìê Mathematical Formulas</h3>
                    
                    <div class="formula-box">
                        <strong>Dipole Moment: p = q √ó 2a</strong>
                    </div>

                    <h4>For r >> a (Far-field):</h4>
                    
                    <div class="formula-box" style="background: linear-gradient(135deg, #00b894, #00a085);">
                        <strong>Axial: E = 2p/(4œÄŒµ‚ÇÄr¬≥)</strong>
                    </div>

                    <div class="formula-box" style="background: linear-gradient(135deg, #e17055, #d63031);">
                        <strong>Equatorial: E = p/(4œÄŒµ‚ÇÄr¬≥)</strong>
                    </div>

                    <div class="key-points">
                        <h4>üìä Key Relationships:</h4>
                        <ul>
                            <li><strong>Distance:</strong> E ‚àù 1/r¬≥ (dipole field)</li>
                            <li><strong>vs Single charge:</strong> E ‚àù 1/r¬≤ (point charge)</li>
                            <li><strong>Axial/Equatorial ratio:</strong> 2:1</li>
                            <li><strong>Direction:</strong> Along p (axial), opposite to p (equatorial)</li>
                        </ul>
                    </div>

                    <div class="highlight">
                        <h4>üí´ Constants:</h4>
                        <p>k = 1/(4œÄŒµ‚ÇÄ) = 9.0 √ó 10‚Åπ N‚ãÖm¬≤/C¬≤</p>
                        <p>Œµ‚ÇÄ = 8.854 √ó 10‚Åª¬π¬≤ C¬≤/(N‚ãÖm¬≤)</p>
                    </div>
                </div>

                <div id="applications" class="tab-content">
                    <h3>üåç Real-World Applications</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>1. üíß Water Molecules (H‚ÇÇO)</h4>
                        <p>Water is a polar molecule with permanent dipole moment enabling hydrogen bonding.</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4>2. üì± Microwave Ovens</h4>
                        <p>Oscillating electric field causes water dipoles to rotate rapidly, generating heat.</p>
                    </div>

                    <div class="key-points">
                        <h4>‚ö° Physics Applications:</h4>
                        <ul>
                            <li><strong>Antennas:</strong> Oscillating dipoles radiate EM waves</li>
                            <li><strong>Capacitors:</strong> Dielectric materials contain molecular dipoles</li>
                            <li><strong>Medical imaging:</strong> NMR uses nuclear magnetic dipoles</li>
                        </ul>
                    </div>

                    <div class="highlight">
                        <h4>üî¨ Examples of Dipole Moments:</h4>
                        <p>‚Ä¢ <strong>H‚ÇÇO:</strong> 6.1 √ó 10‚Åª¬≥‚Å∞ C‚ãÖm</p>
                        <p>‚Ä¢ <strong>HCl:</strong> 3.6 √ó 10‚Åª¬≥‚Å∞ C‚ãÖm</p>
                        <p>‚Ä¢ <strong>CO‚ÇÇ:</strong> 0 (linear, symmetric)</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="quiz-section">
            <div class="quiz-header">
                <h3>üß† Test Your Dipole Knowledge</h3>
                <div class="score-display" id="scoreDisplay">
                    <h4>Your Score</h4>
                    <div class="score-value" id="scoreValue">0/0</div>
                </div>
            </div>
            
            <div class="quiz-container">
                <div class="question-card" id="question1">
                    <div class="question-number">1</div>
                    <div class="question-text">
                        How does the electric field of a dipole vary with distance at large distances?
                    </div>
                    <div class="options">
                        <div class="option" onclick="selectOption(1, 'A')">
                            <div class="option-letter">A</div>
                            <div>1/r¬≤</div>
                        </div>
                        <div class="option" onclick="selectOption(1, 'B')">
                            <div class="option-letter">B</div>
                            <div>1/r¬≥</div>
                        </div>
                        <div class="option" onclick="selectOption(1, 'C')">
                            <div class="option-letter">C</div>
                            <div>1/r</div>
                        </div>
                        <div class="option" onclick="selectOption(1, 'D')">
                            <div class="option-letter">D</div>
                            <div>1/r‚Å¥</div>
                        </div>
                    </div>
                    <button class="check-button" onclick="checkAnswer(1)" disabled>Check Answer</button>
                    <div class="explanation" id="explanation1">
                        <h4>üí° Explanation:</h4>
                        <p>Dipole field falls as 1/r¬≥, faster than a single charge (1/r¬≤).</p>
                    </div>
                </div>

                <div class="question-card" id="question2">
                    <div class="question-number">2</div>
                    <div class="question-text">
                        What is the direction of the electric field on the equatorial plane?
                    </div>
                    <div class="options">
                        <div class="option" onclick="selectOption(2, 'A')">
                            <div class="option-letter">A</div>
                            <div>Along the dipole moment</div>
                        </div>
                        <div class="option" onclick="selectOption(2, 'B')">
                            <div class="option-letter">B</div>
                            <div>Opposite to dipole moment</div>
                        </div>
                        <div class="option" onclick="selectOption(2, 'C')">
                            <div class="option-letter">C</div>
                            <div>Perpendicular to dipole</div>
                        </div>
                        <div class="option" onclick="selectOption(2, 'D')">
                            <div class="option-letter">D</div>
                            <div>Zero field</div>
                        </div>
                    </div>
                    <button class="check-button" onclick="checkAnswer(2)" disabled>Check Answer</button>
                    <div class="explanation" id="explanation2">
                        <h4>üí° Explanation:</h4>
                        <p>On the equatorial plane, the field is opposite to the dipole moment direction.</p>
                    </div>
                </div>

                <div class="question-card" id="question3">
                    <div class="question-number">3</div>
                    <div class="question-text">
                        If you double both charge and separation, how does dipole moment change?
                    </div>
                    <div class="options">
                        <div class="option" onclick="selectOption(3, 'A')">
                            <div class="option-letter">A</div>
                            <div>Doubles</div>
                        </div>
                        <div class="option" onclick="selectOption(3, 'B')">
                            <div class="option-letter">B</div>
                            <div>Triples</div>
                        </div>
                        <div class="option" onclick="selectOption(3, 'C')">
                            <div class="option-letter">C</div>
                            <div>Quadruples</div>
                        </div>
                        <div class="option" onclick="selectOption(3, 'D')">
                            <div class="option-letter">D</div>
                            <div>Remains same</div>
                        </div>
                    </div>
                    <button class="check-button" onclick="checkAnswer(3)" disabled>Check Answer</button>
                    <div class="explanation" id="explanation3">
                        <h4>üí° Explanation:</h4>
                        <p>Since p = q √ó 2a, doubling both gives 4p. The dipole moment quadruples!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const canvas = document.getElementById('dipoleCanvas');
        const ctx = canvas.getContext('2d');
        
        const chargeSlider = document.getElementById('chargeSlider');
        const separationSlider = document.getElementById('separationSlider');
        const orientationSlider = document.getElementById('orientationSlider');
        const distanceSlider = document.getElementById('distanceSlider');
        const angleSlider = document.getElementById('angleSlider');
        const densitySlider = document.getElementById('densitySlider');
        
        const chargeValue = document.getElementById('chargeValue');
        const separationValue = document.getElementById('separationValue');
        const orientationValue = document.getElementById('orientationValue');
        const distanceValue = document.getElementById('distanceValue');
        const angleValue = document.getElementById('angleValue');
        const densityValue = document.getElementById('densityValue');
        
        let time = 0;
        let animationId;

        // Quiz variables
        const quizAnswers = { 1: 'B', 2: 'B', 3: 'C' };
        let userAnswers = {};
        let correctAnswers = 0;

        // Helper function to format numbers in √ó 10^ format
        function formatScientific(num) {
            if (num === 0) return '0.0';
            const exp = Math.floor(Math.log10(Math.abs(num)));
            const mantissa = num / Math.pow(10, exp);
            return `${mantissa.toFixed(1)} √ó 10^${exp}`;
        }
        function drawArrow(ctx, fromX, fromY, toX, toY, color, size = 15) {
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 3;
            
            // Arrow head
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - size * Math.cos(angle - Math.PI/6), toY - size * Math.sin(angle - Math.PI/6));
            ctx.lineTo(toX - size * Math.cos(angle + Math.PI/6), toY - size * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fill();
        }

        // Calculate electric field
        function calculateField(x, y, posX, posY, negX, negY, q) {
            const dx1 = x - posX;
            const dy1 = y - posY;
            const r1 = Math.sqrt(dx1*dx1 + dy1*dy1);
            
            const dx2 = x - negX;
            const dy2 = y - negY;
            const r2 = Math.sqrt(dx2*dx2 + dy2*dy2);
            
            if (r1 < 5 || r2 < 5) return { Ex: 0, Ey: 0, mag: 0 };
            
            // Electric field from positive charge
            const k = 8.99e9; // Coulomb's constant
            const E1mag = k * q * 1e-6 / (r1 * r1); // Convert ¬µC to C
            const E1x = E1mag * dx1 / r1;
            const E1y = E1mag * dy1 / r1;
            
            // Electric field from negative charge  
            const E2mag = k * q * 1e-6 / (r2 * r2);
            const E2x = -E2mag * dx2 / r2; // Negative charge
            const E2y = -E2mag * dy2 / r2;
            
            const Ex = E1x + E2x;
            const Ey = E1y + E2y;
            
            return { Ex, Ey, mag: Math.sqrt(Ex*Ex + Ey*Ey) };
        }

        // Draw field lines
        function drawFieldLines(centerX, centerY, sep, orient, density) {
            const spacing = sep * 20;
            const posX = centerX + Math.cos(orient) * spacing / 2;
            const posY = centerY + Math.sin(orient) * spacing / 2;
            const negX = centerX - Math.cos(orient) * spacing / 2;
            const negY = centerY - Math.sin(orient) * spacing / 2;
            
            ctx.strokeStyle = 'rgba(100, 150, 255, 0.6)';
            ctx.lineWidth = 1.5;
            
            for (let i = 0; i < density; i++) {
                const angle = (i * 2 * Math.PI) / density;
                let x = posX + Math.cos(angle) * 25;
                let y = posY + Math.sin(angle) * 25;
                
                ctx.beginPath();
                ctx.moveTo(x, y);
                
                for (let step = 0; step < 50; step++) {
                    const field = calculateField(x, y, posX, posY, negX, negY, 1);
                    if (field.mag < 0.01) break;
                    
                    const stepSize = 2;
                    const fieldAngle = Math.atan2(field.Ey, field.Ex);
                    x += Math.cos(fieldAngle) * stepSize;
                    y += Math.sin(fieldAngle) * stepSize;
                    
                    const distToNeg = Math.sqrt((x - negX) ** 2 + (y - negY) ** 2);
                    if (distToNeg < 25 || x < 0 || x > canvas.width || y < 0 || y > canvas.height) break;
                    
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }

        // Main drawing function
        function drawSimulation() {
            const q = parseFloat(chargeSlider.value);
            const sep = parseFloat(separationSlider.value);
            const orient = parseFloat(orientationSlider.value) * Math.PI / 180;
            const r = parseFloat(distanceSlider.value);
            const theta = parseFloat(angleSlider.value);
            const density = parseInt(densitySlider.value);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Draw field lines
            drawFieldLines(centerX, centerY, sep, orient, density);
            
            // Charge positions
            const spacing = sep * 20;
            const posX = centerX + Math.cos(orient) * spacing / 2;
            const posY = centerY + Math.sin(orient) * spacing / 2;
            const negX = centerX - Math.cos(orient) * spacing / 2;
            const negY = centerY - Math.sin(orient) * spacing / 2;
            
            // Draw positive charge
            const posRadius = 15 + q * 2;
            ctx.fillStyle = '#e74c3c';
            ctx.strokeStyle = '#c0392b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(posX, posY, posRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Plus sign
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(posX - 8, posY);
            ctx.lineTo(posX + 8, posY);
            ctx.moveTo(posX, posY - 8);
            ctx.lineTo(posX, posY + 8);
            ctx.stroke();
            
            // Draw negative charge
            const negRadius = 15 + q * 2;
            ctx.fillStyle = '#3498db';
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(negX, negY, negRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Minus sign
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(negX - 8, negY);
            ctx.lineTo(negX + 8, negY);
            ctx.stroke();
            
            // Dipole moment vector
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(negX, negY);
            ctx.lineTo(posX, posY);
            ctx.stroke();
            
            drawArrow(ctx, negX + Math.cos(orient) * spacing * 0.3, 
                     negY + Math.sin(orient) * spacing * 0.3,
                     posX - Math.cos(orient) * 10, 
                     posY - Math.sin(orient) * 10, '#27ae60', 15);
            
            // Test point
            const testAngle = theta * Math.PI / 180 + orient;
            const testDist = r * 15;
            const testX = centerX + Math.cos(testAngle) * testDist;
            const testY = centerY + Math.sin(testAngle) * testDist;
            
            // Pulsing test point
            const pulseRadius = 8 + 2 * Math.sin(time * 0.1);
            ctx.fillStyle = '#f39c12';
            ctx.strokeStyle = '#e67e22';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(testX, testY, pulseRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Electric field vector
            const field = calculateField(testX, testY, posX, posY, negX, negY, q);
            let fieldMagnitude = field.mag;
            
            if (field.mag > 0) {
                const fieldLength = Math.min(50, Math.log10(field.mag + 1) * 20);
                const fieldAngle = Math.atan2(field.Ey, field.Ex);
                const fieldEndX = testX + Math.cos(fieldAngle) * fieldLength;
                const fieldEndY = testY + Math.sin(fieldAngle) * fieldLength;
                
                ctx.strokeStyle = '#e17055';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(testX, testY);
                ctx.lineTo(fieldEndX, fieldEndY);
                ctx.stroke();
                
                drawArrow(ctx, testX + Math.cos(fieldAngle) * 10, 
                         testY + Math.sin(fieldAngle) * 10,
                         fieldEndX, fieldEndY, '#e17055', 12);
                
                // Display field magnitude near the vector
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.fillRect(fieldEndX + 5, fieldEndY - 15, 100, 20);
                ctx.fillStyle = '#e17055';
                ctx.font = 'bold 10px Arial';
                ctx.fillText(`E = ${formatScientific(fieldMagnitude)} N/C`, fieldEndX + 8, fieldEndY - 2);
            }
            
            // Store field magnitude for display update
            window.currentFieldMagnitude = fieldMagnitude;
            
            // Distance line
            ctx.strokeStyle = '#95a5a6';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(testX, testY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Labels
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('+q', posX + 20, posY);
            ctx.fillText('-q', negX - 30, negY);
            ctx.fillText('p', centerX + 10, centerY - 10);
            ctx.fillText('E', testX + 15, testY - 15);
            
            // Info box
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(10, 10, 180, 80);
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, 180, 80);
            
            ctx.fillStyle = '#2d3748';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('Dipole Properties:', 20, 30);
            ctx.font = '11px Arial';
            const moment = q * 1e-6 * sep * 1e-3;
            ctx.fillText(`Moment: ${formatScientific(moment)} C‚ãÖm`, 20, 50);
            ctx.fillText(`Charge: ¬±${q.toFixed(1)} ¬µC`, 20, 65);
            ctx.fillText(`Distance: ${r.toFixed(1)} cm`, 20, 80);
        }

        function updateDisplays() {
            const q = parseFloat(chargeSlider.value);
            const sep = parseFloat(separationSlider.value);
            const orient = parseFloat(orientationSlider.value);
            const r = parseFloat(distanceSlider.value);
            const theta = parseFloat(angleSlider.value);
            const density = parseInt(densitySlider.value);
            
            chargeValue.textContent = q.toFixed(1) + ' ¬µC';
            separationValue.textContent = sep.toFixed(1) + ' mm';
            orientationValue.textContent = orient.toFixed(0) + '¬∞';
            distanceValue.textContent = r.toFixed(1) + ' cm';
            angleValue.textContent = theta.toFixed(0) + '¬∞';
            densityValue.textContent = density.toString();
            
            const moment = q * 1e-6 * sep * 1e-3;
            document.getElementById('dipoleValue').textContent = `p = ${formatScientific(moment)} C‚ãÖm`;
            document.getElementById('chargeComponent').textContent = q.toFixed(1) + ' ¬µC';
            document.getElementById('separationComponent').textContent = sep.toFixed(1) + ' mm';
            document.getElementById('distanceComponent').textContent = r.toFixed(1) + ' cm';
            
            // Update field display
            const fieldMag = window.currentFieldMagnitude || 0;
            const fieldDisplay = fieldMag > 0 ? formatScientific(fieldMag) + ' N/C' : '0.0 N/C';
            document.getElementById('fieldComponent').textContent = fieldDisplay;
        }

        function animate() {
            time += 0.05;
            drawSimulation();
            updateDisplays();
            animationId = requestAnimationFrame(animate);
        }

        function showTab(event, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function setDemo(type) {
            switch(type) {
                case 'axial':
                    angleSlider.value = 0;
                    distanceSlider.value = 6;
                    orientationSlider.value = 0;
                    break;
                case 'equatorial':
                    angleSlider.value = 90;
                    distanceSlider.value = 6;
                    orientationSlider.value = 0;
                    break;
                case 'closeup':
                    distanceSlider.value = 3;
                    angleSlider.value = 45;
                    densitySlider.value = 15;
                    break;
                case 'faraway':
                    distanceSlider.value = 9;
                    angleSlider.value = 30;
                    densitySlider.value = 8;
                    break;
            }
        }

        function selectOption(questionNum, option) {
            const options = document.querySelectorAll(`#question${questionNum} .option`);
            options.forEach(opt => opt.classList.remove('selected'));
            
            event.currentTarget.classList.add('selected');
            userAnswers[questionNum] = option;
            
            document.querySelector(`#question${questionNum} .check-button`).disabled = false;
        }

        function checkAnswer(questionNum) {
            const card = document.getElementById(`question${questionNum}`);
            const options = card.querySelectorAll('.option');
            const explanation = document.getElementById(`explanation${questionNum}`);
            const button = card.querySelector('.check-button');
            
            const userAnswer = userAnswers[questionNum];
            const correctAnswer = quizAnswers[questionNum];
            
            options.forEach(option => {
                const letter = option.querySelector('.option-letter').textContent;
                if (letter === correctAnswer) {
                    option.classList.add('correct');
                } else if (letter === userAnswer && userAnswer !== correctAnswer) {
                    option.classList.add('incorrect');
                }
            });
            
            if (userAnswer === correctAnswer) {
                card.classList.add('correct');
                correctAnswers++;
            } else {
                card.classList.add('incorrect');
            }
            
            explanation.classList.add('show');
            button.disabled = true;
            button.textContent = userAnswer === correctAnswer ? '‚úì Correct!' : '‚úó Incorrect';
            
            const answered = Object.keys(userAnswers).length;
            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreValue = document.getElementById('scoreValue');
            
            if (answered > 0) {
                scoreDisplay.style.display = 'block';
                scoreValue.textContent = `${correctAnswers}/${answered}`;
            }
        }

        // Event listeners
        chargeSlider.addEventListener('input', updateSimulation);
        separationSlider.addEventListener('input', updateSimulation);
        orientationSlider.addEventListener('input', updateSimulation);
        distanceSlider.addEventListener('input', updateSimulation);
        angleSlider.addEventListener('input', updateSimulation);
        densitySlider.addEventListener('input', updateSimulation);

        function updateSimulation() {
            drawSimulation();
            updateDisplays();
        }

        // Canvas click interaction
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            const dx = x - centerX;
            const dy = y - centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            const orientation = parseFloat(orientationSlider.value);
            let relativeAngle = angle - orientation;
            if (relativeAngle < 0) relativeAngle += 360;
            if (relativeAngle > 180) relativeAngle = 360 - relativeAngle;
            
            distanceSlider.value = Math.min(10, Math.max(2, distance / 15));
            angleSlider.value = Math.min(180, Math.max(0, relativeAngle));
            
            updateSimulation();
        });

        // Initialize and start
        function init() {
            updateDisplays();
            drawSimulation();
            animate();
        }

        // Start everything
        init();
    </script>
</body>
</html>
